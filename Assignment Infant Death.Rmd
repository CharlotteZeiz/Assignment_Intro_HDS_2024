---
title: "Assignment Intro HDS - Infant Death Scotland"
author: "Sophie Charlotte Zeiz"
date: "2024-11-18"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Infant mortality in Scotland\

For this assignment, I wanted to look into the data from the **Scottish Puclic Health Observatory** regarding infant mortality. "The infant mortality rate is defined as the number of children who die before reaching their first birthday in a given year, expressed per 1 000 live births." [OECD/World Health Organization (2018)](https://doi.org/10.1787/health_glance_ap-2018-8-en). Ending preventable deaths of newborns and children under the age of five is one of the World Health Organisations sustainable development goals [1].\
The dataset used for this assignment was extracted from the [ScotPHO Inline Profiles Tool](https://scotland.shinyapps.io/ScotPHO_profiles_tool/) and is freely available for the public.\

```{r load packages}
library(readr)
library(dplyr)
library(here)
```
```{r load data from scotpho}
library(readr)
infant_mortality_all_geo <- read_csv("ScotPHO_infant death all geo.csv")
View(infant_mortality_all_geo)
```
```{r prepare data variables}
mortality_allgeo <- infant_mortality_all_geo %>% 
  select(`area_code`, `area_type`, `area_name`, `year`,`measure`) %>% 
  rename(Year = `year`,
         Mortality_rate = `measure`
         )
head(mortality_allgeo)
```


## Evolution of the infant mortality rate in Scotland
```{r graph 1 prep}
mortality_scotland_total <- mortality_allgeo %>% 
  select(`area_name`, `Year`,`Mortality_rate`) %>% 
  filter(`area_name` == "Scotland")
```

```{r graph mortality scotland trend}
library(ggplot2)
mortality_scotland_total %>% 
  ggplot() +
  geom_line(aes(x = `Year`, y = `Mortality_rate`))
```
Our available data shows a downward trend in the mortality rate in Scotland between the years 2004 and 2019. In 2004 the mo

##Trends in infant mortality rate per NHS health board in Scotland

```{r data health boards}
mortality_healthboards <- mortality_allgeo %>% 
  select(`area_type`,`area_name`, `Year`,`Mortality_rate`) %>% 
  filter(`area_type` == "Health board")
```

```{r graph per healthboard}
library(ggplot2)
mortality_healthboards %>% 
  select(`area_name`, `Year`,`Mortality_rate`) %>%
  rename( NHS_board = `area_name`) %>% 
  group_by(`NHS_board`) %>% 
  ggplot() +
  geom_line(aes(x = `Year`, y = `Mortality_rate`, colour = `NHS_board`))
```
```{r clean big 4 healthboards}
big4_healthboards <- mortality_healthboards %>%
  select(`area_name`, `Year`, `Mortality_rate`) %>%
  filter(`area_name` %in% c("NHS Greater Glasgow & Clyde", "NHS Grampian", "NHS Lothian", "NHS Tayside"))
```


```{r }
library(ggplot2)
big4_healthboards %>% 
  select(`area_name`, `Year`,`Mortality_rate`) %>%
  rename( NHS_board = `area_name`) %>% 
  group_by(`NHS_board`) %>% 
  ggplot() +
  geom_line(aes(x = `Year`, y = `Mortality_rate`, colour = `NHS_board`))
```
## Enter urban rural data from 2011
```{r load rural urban classification data}
library(readr)
rural_class_complete <- read_csv("scottish-government-urban-rural-classification-2020-data-zone-2011-lookup.csv")
View(rural_class_complete)
```
```{r clean urban rural to 3 categories and}
rural_3fold <- rural_class_complete %>% 
  select(`DataZone`, `UR6FOLD`) %>% 
  rename(area_code = `DataZone`,
         Classification = `UR6FOLD`
         )
```

## Enter council areas to classification data
```{r}
library(readr)
area_to_hsc <- read_csv("dz2011_codes_and_labels_21042020.csv") %>% 
  rename(area_code = `DataZone`)
```

```{r connecting area code and hsc}
rural3fold_CA <- rural_3fold %>%
  inner_join(`area_to_hsc`, by = "area_code") %>% 
  select(area_code, Classification, CA, HSCP, HB)
```

## Combine council area, mortality rates and rural-urban classification
```{r combine rural and mortality}
combined_mortalityallgeo_rural3fold <- mortality_allgeo %>%
  inner_join(`rural3fold_CA`, by = c("area_code" = "CA")) %>% 
  select(area_type, area_name, Year, Mortality_rate, Classification) 
```
```{r get mode with help of chat gtp}
library(dplyr)
get_mode <- function(x) {
  uniq_x <- unique(x)
  uniq_x[which.max(tabulate(match(x, uniq_x)))]
}
```

```{r summaryse mortality and classification per area_name and year}
AVG_mort_class_percouncil_peryear <- combined_mortalityallgeo_rural3fold %>%
  group_by(area_name, Year) %>% 
  summarise(
    avg_mortality_rate = mean(Mortality_rate, na.rm = TRUE),
    mode_classification = get_mode(Classification)
  )
```
```{r create classification categories via mode}
 group_classification <- AVG_mort_class_percouncil_peryear %>% 
  mutate(mode_classification = case_when(
    mode_classification == 1 ~ "Large Urban Areas",
    mode_classification == 2 ~ "Other Urban Areas",
    mode_classification == 3 ~ "Accessible Small Towns",
    mode_classification == 4 ~ "Remote Small Towns",
    mode_classification == 5 ~ "Accessible Rural",
    mode_classification == 6 ~ "Remote Rural",
    TRUE ~ "Unknown"  # In case there are other values that don't fit the categories
  ))
```

```{r average mort rate per classification}
avg_class_mort_year <- AVG_mort_class_percouncil_peryear %>%
  select(`Year`,`avg_mortality_rate`, `mode_classification`) %>%
  group_by(mode_classification, Year) %>%
  summarise(AVG2_mortality_rate = mean(avg_mortality_rate, na.rm = TRUE))
```

```{r Graph2}
library(ggplot2)
avg_class_mort_year %>% 
  select(`Year`, `AVG2_mortality_rate`, `mode_classification`) %>%
  filter(`Year` %in% c("2004", "2008", "2012", "2016")) %>% 
  ggplot(aes(x = `mode_classification`, y = `AVG2_mortality_rate`, group = `Year`)) +
  geom_col()
```
```{r average mort rate per text classification}
avg_class_mort_year <- group_classification %>%
  select(`Year`,`avg_mortality_rate`, `mode_classification`) %>%
  group_by(mode_classification, Year) %>%
  summarise(avg_mortalityrate = mean(avg_mortality_rate, na.rm = TRUE))
```
```{r}
library(ggplot2)
avg_class_mort_year %>% 
  select(`Year`,`avg_mortalityrate`, `mode_classification`) %>%
  group_by(mode_classification) %>% 
  ggplot() +
  geom_line(aes(x= Year, y= avg_mortalityrate, colour = mode_classification))
```


[1]: https://www.who.int/data/gho/data/themes/topics/sdg-target-3_2-newborn-and-child-mortality)